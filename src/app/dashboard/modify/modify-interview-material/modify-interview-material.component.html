<div class="container-lg">
	<div class="row">
		<div class="col-6">
			<rd-card [cardTitle]="'View Interview Material'">
				<div class="row">
					<div class="col-6">
						<ng-select
							[items]="phaseTypes$ | async"
							[clearable]="false"
							bindLabel="val"
							placeholder="Phase"
							[searchable]="false"
							[ngModel]="(phaseTypes$ | async)[0]"
						></ng-select>
					</div>
					<div class="col-6">
						<ng-select
							[items]="phases$ | async"
							[clearable]="false"
							bindLabel="Description"
							placeholder="Phase"
							[searchable]="false"
							[ngModel]="currentPhase$ | async"
							(change)="currentPhase$.next($event)"
						></ng-select>
					</div>
				</div>
				<!-- <div class="col v-list-m-12 v-list-bordered px-0">
					<div class="row">
						<ng-select
							[items]="phaseTypes$ | async"
							[clearable]="false"
							bindLabel="val"
							placeholder="Phase"
							[searchable]="false"
							[ngModel]="(phaseTypes$ | async)[0]"
						></ng-select>
					</div>
					<div class="row">
						<ng-select
							[items]="phases$ | async"
							[clearable]="false"
							bindLabel="Description"
							placeholder="Phase"
							[searchable]="false"
							[ngModel]="currentPhase$ | async"
							(change)="currentPhase$.next($event)"
						></ng-select>
					</div>
				</div> -->
			</rd-card>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<rd-card [cardTitle]="'Insert Material'" [isLoading]="loadingFormInterviewMaterial$ | async">
				<div class="row h-list-bordered">
					<form class="col" [formGroup]="singleUploadForm">
						<div class="row form-group border-lightgrey border-bottom justify-content-center">
							<h6><b>Insert Per Trainee</b></h6>
						</div>
						<div class="row form-group">
							<div class="col">
								<ng-select
									[items]="trainees$ | async"
									bindLabel="TraineeCode"
									bindValue="TraineeId"
									[clearable]="false"
									[searchable]="true"
									formControlName="trainee_Id"
								>
									<ng-template ng-label-tmp let-item="item">
										<span>{{ item.codeAndName }}</span>
									</ng-template>
									<ng-template ng-option-tmp let-item="item" let-index="index">
										<span>{{ item.codeAndName }}</span>
									</ng-template>
								</ng-select>
								<span class="font-italic">Note: You can search by T999 code</span>
							</div>
						</div>
						<div class="row form-group">
							<label for="materialName" class="col-3 col-form-label"> Name </label>
							<div class="col">
								<input type="text" class="form-control" formControlName="materialName" />
							</div>
						</div>
						<div class="row form-group">
							<div class="row">
								<label for="materialUpload" class="col-3 col-form-label"> File </label>
								<div class="col input-group">
									<input
										class="form-control"
										type="file"
										(change)="uploadSingleFile($event.target.files)"
									/>
									<div class="input-group-append" [hidden]="!hasSingleFile">
										<ng-template #popContent>
											<div class="p-2">
												Remove uploaded files?
												<ul class="pl-3">
													<li>
														{{ singleUploadForm.get('fileName').value }}
													</li>
												</ul>
											</div>
										</ng-template>
										<button
											class="btn btn-info hover-switch-content"
											[ngbPopover]="popContent"
											triggers="mouseenter:mouseleave"
											title="Remove uploaded files"
											(click)="removeSingleUploadFile()"
										>
											<fa-icon [icon]="['fas', 'check']" class="not-hovered"></fa-icon>
											<fa-icon [icon]="['fas', 'times']" class="hovered"></fa-icon>
										</button>
									</div>
								</div>
							</div>
						</div>
						<div class="row form-group justify-content-center">
							<button
								class="btn btn-primary"
								[disabled]="singleUploadForm.invalid"
								(click)="submitInsertPerTraineeForm()"
							>
								<fa-icon [icon]="['fas', 'plus']"></fa-icon> Insert
							</button>
						</div>
					</form>
					<div class="col">
						<div class="row form-group border-lightgrey border-bottom justify-content-center">
							<h6><b>Mass Insert</b></h6>
						</div>
						<div class="row form-group">
							<input type="file" multiple (change)="massUpload($event.target.files)" />
							<span class="font-italic">Note: Files must have prefix 'T999_name'</span>
						</div>
						<div class="row" [hidden]="isUploadingSingle$ | async">Uploaded Files:</div>
						<div class="row" [hidden]="isUploadingSingle$ | async">
							<ul>
								<li *ngFor="let file of uploadedFiles$ | async">{{ file.filename }}</li>
							</ul>
						</div>
						<div class="row form-group justify-content-around">
							<button class="btn btn-primary" [disabled]="!(isUploadingSingle$ | async)">
								<fa-icon [icon]="['fas', 'plus']"></fa-icon> Submit
							</button>
						</div>
					</div>
				</div>
			</rd-card>
			<rd-card
				[cardTitle]="'Interview Material List'"
				[isLoading]="loadingViewInterviewMaterial$ | async"
			>
				<table class="table table-sm table-hover">
					<thead>
						<tr>
							<th class="text-center">Trainee</th>
							<th class="text-center">File List</th>
							<th class="text-center">Action</th>
							<!-- <th>Actions</th> -->
							<!-- <th width="100px">Actions</th> -->
						</tr>
					</thead>
					<tbody>
						<tr *ngIf="(interviewMaterials$ | async)?.length === 0">
							<td colspan="3" class="text-center">No interview materials yet</td>
						</tr>
						<ng-container
							class="cursor-pointer"
							*ngFor="let interviewMaterial of interviewMaterials$ | async"
						>
							<tr *ngFor="let material of interviewMaterial.Materials; let i = index">
								<td [attr.rowSpan]="interviewMaterial.Materials.length" *ngIf="i === 0">
									{{ interviewMaterial.Trainee.codeAndName }}
								</td>
								<td>
									<a [title]="material.linkTitle" [href]="material.downloadLink">{{
										material.MaterialName
									}}</a>
								</td>
								<td class="text-center">
									<rd-confirmable-pop-up
                    [title]="'Delete ' + material.MaterialName + '?'"
                    [description]="deleteReasonTemplate"
                    [canConfirm]="deleteReasonText.valid"
                    (confirm)="deleteTraineeFile(interviewMaterial, material)"
                    (cancel)="deleteReasonText.reset()"
									>
										<ng-template #deleteReasonTemplate>
                      <textarea
                        class="form-control"
                        [formControl]="deleteReasonText"
                        placeholder="Input reasons here..."
                        cols="30"
                        rows="4"
                      ></textarea>
                    </ng-template>
										<button class="btn btn-xs btn-danger">
											<fa-icon [icon]="['far', 'trash-alt']"></fa-icon> Delete
										</button>
									</rd-confirmable-pop-up>
								</td>
							</tr>
						</ng-container>
						<!-- Old: Materials are looped to create a list in 1 row -->
						<!-- <tr *ngFor="let trainee of interviewMaterials$ | async" class="cursor-pointer">
							<td [attr.rowSpan]="trainee.Materials.length">{{ trainee.Trainee.codeAndName }}</td>
							<td>
								<ul>
							<li *ngFor="let material of trainee.Materials">
								<a [title]="material.linkTitle" [href]="material.downloadLink">{{
									material.MaterialName
								}}</a>
							</li>
							</ul>
							</td>
							<td></td>
						</tr> -->
					</tbody>
				</table>
			</rd-card>
		</div>
	</div>
</div>
